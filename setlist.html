<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Setlist arrangement for worship songs">
    <meta name="view-transition" content="same-origin">
    <title>Setlist - Setalight</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="app-container">
        <div id="song-view" class="view">
            <app-header
                id="app-header"
                title="Loading..."
                show-edit-toggle
                show-info-button>
                <div slot="controls" class="header-controls-slot">
                    <button class="reset-button edit-mode-control" id="reset-button" aria-label="Reset song">↺</button>
                    <div class="font-size-controls edit-mode-control">
                        <button class="font-size-btn" id="font-size-decrease" aria-label="Decrease font size">A−</button>
                        <button class="font-size-btn" id="font-size-increase" aria-label="Increase font size">A+</button>
                    </div>
                    <!-- Key display/selector (same button for both modes) -->
                    <div class="key-display-wrapper">
                        <label class="meta-label">Key:</label>
                        <button id="key-selector-button" class="key-selector" popovertarget="key-selector-popover">
                            <span id="key-selector-value">-</span>
                        </button>
                        <div id="key-selector-popover" class="key-popover" popover>
                            <div id="key-options-list" class="key-options-list">
                                <!-- Options populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    <div class="song-meta-compact" id="song-meta-header"></div>
                </div>
            </app-header>

            <!-- Navigation menu component -->
            <nav-menu id="nav-menu" show-back-button back-label="Back"></nav-menu>

            <main id="main-content">
                <div class="song-container">
                    <p>Loading setlist...</p>
                </div>
            </main>
        </div>

        <!-- Song info modal -->
        <div class="modal-overlay" id="song-info-modal">
            <div class="modal-content">
                <button class="modal-close" id="modal-close">&times;</button>
                <div id="modal-body"></div>
            </div>
        </div>

        <!-- Reset confirmation modal -->
        <div class="modal-overlay" id="reset-confirm-modal">
            <div class="modal-content">
                <h2>Reset Song?</h2>
                <p>This will reset the key, BPM, font size, and all section states back to defaults. This cannot be undone.</p>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-cancel" id="reset-cancel">Cancel</button>
                    <button class="modal-btn modal-btn-confirm" id="reset-confirm">Reset</button>
                </div>
            </div>
        </div>

        <!-- Add Song modal -->
        <div class="modal-overlay add-song-modal-overlay" id="add-song-modal">
            <div class="modal-content add-song-modal-content">
                <button class="modal-close" id="add-song-modal-close">&times;</button>
                <h2>Add Song to Setlist</h2>
                <div class="song-library-header">
                    <input
                        type="text"
                        id="add-song-search-input"
                        class="song-search-input"
                        placeholder="Search songs by title, artist, or lyrics..."
                        autocomplete="off"
                    >
                </div>
                <div id="add-song-results" class="song-library-list">
                    <p style="text-align: center; color: #95a5a6;">Start typing to search songs...</p>
                </div>
            </div>
        </div>

        <!-- Delete Song confirmation modal -->
        <div class="modal-overlay" id="delete-song-modal">
            <div class="modal-content">
                <h2>Remove Song from Setlist?</h2>
                <p>Are you sure you want to remove "<strong id="delete-song-title"></strong>" from this setlist?</p>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-cancel" id="delete-song-cancel">Cancel</button>
                    <button class="modal-btn modal-btn-confirm" id="delete-song-confirm">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template for key option item -->
    <template id="key-option-template">
        <button class="key-option-item">
            <span class="key-name"></span>
            <span class="key-offset"></span>
        </button>
    </template>

    <!-- Template for song info modal item -->
    <template id="song-info-item-template">
        <div class="modal-info-item">
            <div class="modal-info-label"></div>
            <div class="modal-info-value"></div>
        </div>
    </template>

    <!-- Import map for Lit -->
    <script type="importmap">
    {
        "imports": {
            "lit": "https://cdn.jsdelivr.net/npm/lit@3.1.0/index.js",
            "lit/": "https://cdn.jsdelivr.net/npm/lit@3.1.0/",
            "@lit/reactive-element": "https://cdn.jsdelivr.net/npm/@lit/reactive-element@2.0.4/reactive-element.js",
            "@lit/reactive-element/": "https://cdn.jsdelivr.net/npm/@lit/reactive-element@2.0.4/",
            "lit-element/lit-element.js": "https://cdn.jsdelivr.net/npm/lit-element@4.0.4/lit-element.js",
            "lit-html": "https://cdn.jsdelivr.net/npm/lit-html@3.1.0/lit-html.js",
            "lit-html/": "https://cdn.jsdelivr.net/npm/lit-html@3.1.0/"
        }
    }
    </script>

    <script>
        // Set window name so bookmarklet can find and reuse this tab
        window.name = 'setalight';
    </script>
    <!-- Import the components -->
    <script type="module" src="/components/song-card.js"></script>
    <script type="module" src="/components/app-header.js"></script>
    <script type="module" src="/components/nav-menu.js"></script>
    <script type="module" src="/js/setlist-app.js"></script>
</body>
</html>
