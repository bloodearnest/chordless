<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Import song via bookmarklet" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="icon" type="image/svg+xml" href="/icons/favicon-light.svg" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
    <title>Import Song - Setalight</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="app-container">
      <div class="view">
        <header>
          <h1>Import Song</h1>
        </header>

        <main style="padding: 2rem; max-width: 600px; margin: 0 auto">
          <div id="import-status">
            <p style="text-align: center; color: #7f8c8d">
              Waiting for song data from bookmarklet...
            </p>
          </div>

          <div id="import-choices" style="display: none">
            <h2 id="imported-song-title" style="margin-bottom: 1.5rem"></h2>

            <div
              id="duplicate-warning"
              style="
                display: none;
                background: #fff3cd;
                border: 2px solid #ffc107;
                border-radius: 8px;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
              "
            >
              <strong style="display: block; margin-bottom: 0.75rem"
                >‚ö†Ô∏è This song already exists in your library</strong
              >
              <p style="margin: 0 0 1rem 0">
                Do you want to update the song with the new version, or use the existing one?
              </p>
              <div style="display: flex; gap: 0.75rem">
                <button id="duplicate-update" class="modal-btn modal-btn-primary" style="flex: 1">
                  Update Song
                </button>
                <button
                  id="duplicate-use-existing"
                  class="modal-btn modal-btn-cancel"
                  style="flex: 1"
                >
                  Use Existing
                </button>
              </div>
            </div>

            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 1rem;
                max-width: 700px;
                margin: 0 auto;
                width: 100%;
              "
            >
              <button
                id="choice-recent-setlist"
                class="choice-button choice-button-with-select"
                style="display: none"
              >
                <div class="choice-button-icon">üìã</div>
                <div class="choice-button-content">
                  <div class="choice-button-title">Add to Setlist</div>
                  <select
                    id="recent-setlist-select"
                    class="recent-setlist-select-inline"
                    onclick="event.stopPropagation();"
                  >
                    <!-- Options populated by JavaScript -->
                  </select>
                </div>
              </button>

              <button id="choice-new-setlist" class="choice-button">
                <div class="choice-button-icon">‚ûï</div>
                <div class="choice-button-content">
                  <div class="choice-button-title">Create New Setlist</div>
                  <div class="choice-button-subtitle">Start a fresh setlist with this song</div>
                </div>
              </button>

              <button id="choice-library-only" class="choice-button">
                <div class="choice-button-icon">üíæ</div>
                <div class="choice-button-content">
                  <div class="choice-button-title">Save to Library Only</div>
                  <div class="choice-button-subtitle">Don't add to any setlist</div>
                </div>
              </button>
            </div>
          </div>
        </main>

        <!-- Create Setlist Modal (reused from index.html) -->
        <div class="modal-overlay" id="create-setlist-modal">
          <div class="modal-content">
            <button class="modal-close" id="create-modal-close">&times;</button>
            <h2>Create New Setlist</h2>
            <form id="create-setlist-form">
              <div class="form-field">
                <label for="setlist-date">Date</label>
                <input type="date" id="setlist-date" name="date" required />
              </div>
              <div class="form-field">
                <label for="setlist-time">Time</label>
                <input type="time" id="setlist-time" name="time" value="10:30" required />
              </div>
              <div class="form-field">
                <label for="setlist-type">Type</label>
                <select id="setlist-type" name="type" required>
                  <option value="Church Service">Church Service</option>
                  <option value="Prayer Meeting">Prayer Meeting</option>
                  <option value="Event">Event</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-field">
                <label for="setlist-name">Name (optional)</label>
                <input
                  type="text"
                  id="setlist-name"
                  name="name"
                  placeholder="e.g. Youth Service, Christmas Special"
                />
              </div>
              <div class="form-field">
                <label for="setlist-leader">Leader (optional)</label>
                <input
                  type="text"
                  id="setlist-leader"
                  name="leader"
                  placeholder="e.g. John Smith"
                />
              </div>
              <div class="modal-actions">
                <button type="button" class="modal-btn modal-btn-cancel" id="create-cancel">
                  Cancel
                </button>
                <button type="submit" class="modal-btn modal-btn-primary">Create & Add Song</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Set window name so bookmarklet can find and reuse this tab
      window.name = 'setalight';
    </script>
    <script type="module" src="/js/import-song-handler.js"></script>
  </body>
</html>
